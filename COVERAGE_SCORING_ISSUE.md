# Coverage è©•åˆ†é‚è¼¯å•é¡Œåˆ†æ

## ğŸš¨ å•é¡Œç™¼ç¾

### **å¯¦éš›æ•¸æ“š**
```
é«˜å£“æ»…èŒé‹        â†’ Tavily è¿”å› 9 å€‹çµæœ  â†’ Coverage åˆ†æ•¸: 4.5
é«˜å£“è’¸æ°£æ»…èŒå™¨    â†’ Tavily è¿”å› 10 å€‹çµæœ â†’ Coverage åˆ†æ•¸: 5.0
```

### **å•é¡Œ**
ã€Œé«˜å£“æ»…èŒé‹ã€æ˜¯æ›´å¸¸è¦‹çš„ç”¨è©ï¼Œä½† Coverage åˆ†æ•¸åè€Œ**æ›´ä½**ã€‚

---

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### **ç•¶å‰è©•åˆ†é‚è¼¯ï¼ˆsemantic_score.py:79-82ï¼‰**

```python
res = tavily.search(q, max_results=10)
num = len(res.get("results", []))
score = min(num / 10 * 5, 5)
```

**è¨ˆç®—å…¬å¼**ï¼š
```
Coverage åˆ†æ•¸ = min(è¿”å›çµæœæ•¸ / 10 * 5, 5)
```

### **å•é¡Œæ‹†è§£**

#### **å•é¡Œ 1ï¼šTavily è¿”å›çµæœæ•¸ä¸ç­‰æ–¼æœå°‹è¦†è“‹åº¦**

| æŸ¥è©¢ | Tavily è¿”å›çµæœæ•¸ | Coverage åˆ†æ•¸ | çœŸå¯¦æœå°‹é‡ï¼ˆä¼°è¨ˆï¼‰ |
|------|------------------|--------------|------------------|
| é«˜å£“æ»…èŒé‹ | 9 | 4.5 | **é«˜**ï¼ˆå¸¸è¦‹ç”¨è©ï¼‰ |
| é«˜å£“è’¸æ°£æ»…èŒå™¨ | 10 | 5.0 | ä¸­ï¼ˆå°ˆæ¥­ç”¨è©ï¼‰ |

**çŸ›ç›¾**ï¼š
- Tavily åªæ˜¯ã€Œæ‰¾åˆ° 9 å€‹ç›¸é—œç¶²é ã€vsã€Œæ‰¾åˆ° 10 å€‹ç›¸é—œç¶²é ã€
- é€™ä¸ä»£è¡¨ã€Œé«˜å£“è’¸æ°£æ»…èŒå™¨ã€çš„æœå°‹é‡æ›´é«˜
- **Tavily çš„çµæœæ•¸å–æ±ºæ–¼å®ƒçš„ç®—æ³•ï¼Œä¸æ˜¯çœŸå¯¦æœå°‹é‡**

#### **å•é¡Œ 2ï¼šmax_results=10 å°è‡´å¤©èŠ±æ¿æ•ˆæ‡‰**

ç•¶ `max_results=10` æ™‚ï¼š
- å¤§éƒ¨åˆ†æŸ¥è©¢éƒ½èƒ½è¿”å› 9-10 å€‹çµæœ
- å·®ç•°åªæœ‰ 0.5 åˆ†ï¼ˆ4.5 vs 5.0ï¼‰
- **å€åˆ†åº¦æ¥µä½**

#### **å•é¡Œ 3ï¼šTavily ç®—æ³•ä¸é€æ˜**

ç‚ºä»€éº¼ã€Œé«˜å£“æ»…èŒé‹ã€åªè¿”å› 9 å€‹çµæœï¼Ÿ
- â“ Tavily èªç‚ºç¬¬ 10 å€‹çµæœç›¸é—œæ€§å¤ªä½ï¼Ÿ
- â“ Tavily çš„ç´¢å¼•ä¸­åªæœ‰ 9 å€‹é«˜å“è³ªç¶²é ï¼Ÿ
- â“ éš¨æ©Ÿèª¤å·®ï¼Ÿ

**çµè«–**ï¼šæˆ‘å€‘ä¸çŸ¥é“ï¼Œå› ç‚º Tavily API ä¸æä¾›é€™å€‹è³‡è¨Šã€‚

---

## ğŸ“Š çœŸå¯¦çš„ Coverageï¼ˆæœå°‹è¦†è“‹åº¦ï¼‰æ‡‰è©²æ€éº¼æ¸¬é‡ï¼Ÿ

### **å®šç¾©ï¼šCoverage = å¸‚å ´éœ€æ±‚ + å…§å®¹ä¾›çµ¦**

#### **å¸‚å ´éœ€æ±‚æŒ‡æ¨™**
1. **æœå°‹é‡ï¼ˆSearch Volumeï¼‰**
   - Google Keyword Planner
   - Google Trends
   - Ahrefs/SEMrush

2. **æœå°‹è¶¨å‹¢**
   - ä¸Šå‡/ä¸‹é™è¶¨å‹¢
   - å­£ç¯€æ€§è®ŠåŒ–

#### **å…§å®¹ä¾›çµ¦æŒ‡æ¨™**
1. **ç¸½æœå°‹çµæœæ•¸ï¼ˆTotal Resultsï¼‰**
   - SerpAPI: `search_information.total_results`
   - ç¯„ä¾‹ï¼šã€Œé«˜å£“æ»…èŒé‹ã€â†’ 1,230,000 ç­†çµæœ

2. **ç«¶çˆ­åº¦ï¼ˆCompetitionï¼‰**
   - ä½ç«¶çˆ­ = å®¹æ˜“æ’å
   - é«˜ç«¶çˆ­ = é›£æ’å

---

## ğŸ”§ ä¿®æ­£æ–¹æ¡ˆ

### **æ–¹æ¡ˆ Aï¼šä½¿ç”¨ SerpAPI Total Resultsï¼ˆæ¨è–¦ï¼‰**

**å„ªå‹¢**ï¼š
- âœ… çœŸå¯¦åæ˜  Google æœå°‹çµæœæ•¸
- âœ… å·²ç¶“æœ‰ SerpAPIï¼ˆä¸éœ€é¡å¤– APIï¼‰
- âœ… æ•¸é‡ç´šå·®ç•°å¤§ï¼ˆæ˜“æ–¼å€åˆ†ï¼‰

**å¯¦ä½œ**ï¼š

```python
# semantic_score.py ä¿®æ­£

from serpapi import GoogleSearch

def get_coverage_score_serpapi(query: str) -> float:
    """
    ä½¿ç”¨ SerpAPI çš„ total_results è¨ˆç®— Coverage åˆ†æ•¸
    """
    params = {
        "q": query,
        "hl": "zh-TW",
        "gl": "tw",
        "api_key": SERPAPI_KEY
    }

    try:
        search = GoogleSearch(params)
        results = search.get_dict()

        # å–å¾—ç¸½æœå°‹çµæœæ•¸
        total_results = results.get("search_information", {}).get("total_results", 0)

        # è©•åˆ†é‚è¼¯ï¼šå°æ•¸ç¸®æ”¾ï¼ˆå› ç‚ºçµæœæ•¸å·®ç•°æ¥µå¤§ï¼‰
        import math
        if total_results == 0:
            return 0

        # log10(total_results) ç¸®æ”¾åˆ° 0-5 åˆ†
        # ç¯„ä¾‹ï¼š
        # 1,000 çµæœ â†’ log10(1000) = 3 â†’ score = 3
        # 10,000 çµæœ â†’ log10(10000) = 4 â†’ score = 4
        # 100,000 çµæœ â†’ log10(100000) = 5 â†’ score = 5
        # 1,000,000+ çµæœ â†’ log10(1000000) = 6 â†’ score = 5 (cap)

        score = min(math.log10(total_results), 5)
        return round(score, 2)

    except Exception as e:
        print(f"âŒ SerpAPI error @ {query}: {e}")
        return 0
```

**é æœŸçµæœ**ï¼š
```
é«˜å£“æ»…èŒé‹      â†’ 1,230,000 çµæœ â†’ log10(1230000) = 6.09 â†’ 5.0 åˆ†
é«˜å£“è’¸æ°£æ»…èŒå™¨  â†’ 456,000 çµæœ   â†’ log10(456000) = 5.66  â†’ 5.0 åˆ†ï¼ˆcapï¼‰

æˆ–è€…ç”¨ä¸åŒçš„ç¸®æ”¾ï¼š
é«˜å£“æ»…èŒé‹      â†’ 1,230,000 â†’ (log10(1230000) - 3) * 2.5 = 7.73 â†’ 5.0 åˆ†ï¼ˆcapï¼‰
é«˜å£“è’¸æ°£æ»…èŒå™¨  â†’ 456,000   â†’ (log10(456000) - 3) * 2.5 = 6.65  â†’ 5.0 åˆ†ï¼ˆcapï¼‰
```

---

### **æ–¹æ¡ˆ Bï¼šä½¿ç”¨ Google Trendsï¼ˆæœ€æº–ç¢ºï¼‰**

**å„ªå‹¢**ï¼š
- âœ… çœŸå¯¦æœå°‹é‡æ•¸æ“šï¼ˆç›¸å°å€¼ï¼‰
- âœ… å¯ä»¥æ¯”è¼ƒå¤šå€‹æŸ¥è©¢çš„ç›¸å°ç†±åº¦

**ç¼ºé»**ï¼š
- âŒ éœ€è¦é¡å¤–çš„ pytrends å¥—ä»¶
- âŒ Google Trends æœ‰é€Ÿç‡é™åˆ¶
- âŒ åªæä¾›ç›¸å°å€¼ï¼ˆ0-100ï¼‰ï¼Œä¸æ˜¯çµ•å°æœå°‹é‡

**å¯¦ä½œ**ï¼š

```python
from pytrends.request import TrendReq

def get_coverage_score_trends(queries: List[str]) -> Dict[str, float]:
    """
    ä½¿ç”¨ Google Trends æ¯”è¼ƒæŸ¥è©¢çš„ç›¸å°æœå°‹é‡
    """
    pytrends = TrendReq(hl='zh-TW', tz=480)

    # Google Trends ä¸€æ¬¡æœ€å¤šæ¯”è¼ƒ 5 å€‹æŸ¥è©¢
    pytrends.build_payload(queries[:5], timeframe='today 12-m', geo='TW')

    # å–å¾—èˆˆè¶£åº¦ï¼ˆ0-100ï¼‰
    interest = pytrends.interest_over_time()

    scores = {}
    for query in queries[:5]:
        if query in interest.columns:
            # å¹³å‡èˆˆè¶£åº¦ï¼ˆ0-100ï¼‰â†’ è½‰æ›ç‚º 0-5 åˆ†
            avg_interest = interest[query].mean()
            scores[query] = round(avg_interest / 100 * 5, 2)
        else:
            scores[query] = 0

    return scores
```

**é æœŸçµæœ**ï¼š
```
é«˜å£“æ»…èŒé‹      â†’ èˆˆè¶£åº¦ 75  â†’ 3.75 åˆ†
é«˜å£“è’¸æ°£æ»…èŒå™¨  â†’ èˆˆè¶£åº¦ 45  â†’ 2.25 åˆ†
```

---

### **æ–¹æ¡ˆ Cï¼šç§»é™¤ Coverage ç¶­åº¦ï¼ˆç°¡åŒ–ï¼‰**

**ç†ç”±**ï¼š
- Coverage çš„æ¸¬é‡æœ¬ä¾†å°±ä¸æº–ç¢º
- Relevance + Density å·²ç¶“è¶³å¤ è©•ä¼°æŸ¥è©¢å“è³ª

**ä¿®æ”¹è©•åˆ†å…¬å¼**ï¼š
```python
# ç•¶å‰ï¼š
final_score = (Coverage Ã— 0.4) + (Relevance Ã— 0.4) + (Density Ã— 0.2)

# ä¿®æ”¹å¾Œï¼š
final_score = (Relevance Ã— 0.6) + (Density Ã— 0.4)
```

---

### **æ–¹æ¡ˆ Dï¼šä¿æŒ Tavilyï¼Œä½†èª¿æ•´è©•åˆ†é‚è¼¯**

**ä¿®æ­£ç•¶å‰çš„å•é¡Œ**ï¼š

```python
# ç•¶å‰ï¼ˆæœ‰å•é¡Œï¼‰ï¼š
res = tavily.search(q, max_results=10)
num = len(res.get("results", []))
score = min(num / 10 * 5, 5)

# ä¿®æ­£å¾Œï¼šå¢åŠ  max_resultsï¼Œé¿å…å¤©èŠ±æ¿æ•ˆæ‡‰
res = tavily.search(q, max_results=50)  # â† å¢åŠ åˆ° 50
num = len(res.get("results", []))
score = min(num / 50 * 5, 5)  # â† å°æ‡‰èª¿æ•´

# æˆ–è€…ï¼šä½¿ç”¨ç›¸é—œæ€§åˆ†æ•¸çš„å¹³å‡å€¼
avg_relevance = sum(r["score"] for r in res["results"]) / len(res["results"])
score = avg_relevance * 5  # 0-1 â†’ 0-5
```

**å•é¡Œ**ï¼š
- ä»ç„¶ä¸æ˜¯çœŸå¯¦æœå°‹é‡
- å¢åŠ  API æˆæœ¬ï¼ˆmax_results=50ï¼‰

---

## ğŸ¯ æ¨è–¦æ–¹æ¡ˆ

### **çŸ­æœŸï¼šæ–¹æ¡ˆ Aï¼ˆSerpAPI Total Resultsï¼‰**

**ç†ç”±**ï¼š
1. âœ… å·²ç¶“æœ‰ SerpAPIï¼Œä¸éœ€é¡å¤–æˆæœ¬
2. âœ… çœŸå¯¦åæ˜  Google æœå°‹çµæœæ•¸
3. âœ… å¯¦ä½œç°¡å–®

**å¯¦ä½œæ­¥é©Ÿ**ï¼š
1. ä¿®æ”¹ `semantic_score.py` çš„ Coverage è¨ˆç®—é‚è¼¯
2. ä½¿ç”¨ `SerpAPI.search_information.total_results`
3. ä½¿ç”¨ log10 ç¸®æ”¾åˆ° 0-5 åˆ†

### **é•·æœŸï¼šæ–¹æ¡ˆ Bï¼ˆGoogle Trendsï¼‰+ æ–¹æ¡ˆ A**

**æ··åˆä½¿ç”¨**ï¼š
- **Google Trends**ï¼šç›¸å°æœå°‹é‡ï¼ˆä¸»è¦æŒ‡æ¨™ï¼‰
- **SerpAPI Total Results**ï¼šå…§å®¹ä¾›çµ¦ï¼ˆè¼”åŠ©æŒ‡æ¨™ï¼‰
- **ç¶œåˆè©•åˆ†**ï¼š`(Trends Ã— 0.6) + (Total Results Ã— 0.4)`

---

## ğŸ“‹ ä¿®æ­£å¾Œçš„è©•åˆ†é«”ç³»

### **ä¸‰ç¶­è©•åˆ†ï¼ˆä¿®æ­£å¾Œï¼‰**

```
Coverageï¼ˆè¦†è“‹åº¦ï¼‰- ä½¿ç”¨ SerpAPI Total Results
  â†“
è¨ˆç®—å…¬å¼ï¼šscore = min(log10(total_results), 5)
  â†“
ç¯„ä¾‹ï¼š
- 1,000,000 çµæœ â†’ 5.0 åˆ†ï¼ˆé«˜æœå°‹é‡ï¼‰
- 100,000 çµæœ  â†’ 5.0 åˆ†ï¼ˆä¸­æœå°‹é‡ï¼‰
- 10,000 çµæœ   â†’ 4.0 åˆ†ï¼ˆä½æœå°‹é‡ï¼‰
- 1,000 çµæœ    â†’ 3.0 åˆ†ï¼ˆæ¥µä½æœå°‹é‡ï¼‰

Relevanceï¼ˆç›¸é—œæ€§ï¼‰- ä¿æŒä¸è®Š
  â†“
Embedding Ã— 0.6 + LLM Ã— 0.4

Densityï¼ˆå¯†åº¦ï¼‰- ä¿æŒä¸è®Š
  â†“
KMeans èšé¡åˆ†æ

æœ€çµ‚åˆ†æ•¸ï¼š
  â†“
(Coverage Ã— 0.4) + (Relevance Ã— 0.4) + (Density Ã— 0.2)
```

---

## âœ… ä¸‹ä¸€æ­¥è¡Œå‹•

1. **æ¸¬è©¦ SerpAPI Total Results**
   ```python
   # æ¸¬è©¦ã€Œé«˜å£“æ»…èŒé‹ã€vsã€Œé«˜å£“è’¸æ°£æ»…èŒå™¨ã€çš„ total_results
   ```

2. **ä¿®æ”¹ semantic_score.py**
   - æ›¿æ› Tavily Coverage ç‚º SerpAPI Total Results
   - ä½¿ç”¨ log10 ç¸®æ”¾

3. **é‡æ–°è©•åˆ†ã€Œé«˜å£“æ»…èŒé‹ã€çš„ 25 å€‹æŸ¥è©¢**
   - é©—è­‰ä¿®æ­£å¾Œçš„åˆ†æ•¸æ›´åˆç†

4. **æ›´æ–°æ–‡æª”**
   - æ›´æ–° PIPELINE_LOGIC_REVIEW.md
   - èªªæ˜æ–°çš„ Coverage è©•åˆ†é‚è¼¯

---

ä½ æƒ³è¦æˆ‘ï¼š
1. **ç«‹å³å¯¦ä½œæ–¹æ¡ˆ Aï¼ˆSerpAPI Total Resultsï¼‰**ï¼Ÿ
2. **å…ˆæ¸¬è©¦ SerpAPI Total Results çš„å¯¦éš›æ•ˆæœ**ï¼Ÿ
3. **è¨è«–æ˜¯å¦æ¡ç”¨æ–¹æ¡ˆ Bï¼ˆGoogle Trendsï¼‰**ï¼Ÿ
